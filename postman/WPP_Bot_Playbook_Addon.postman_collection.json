{
	"info": {
		"_postman_id": "playbook-endpoints-addon",
		"name": "WPP Bot API - Playbook System Addon",
		"description": "Novos endpoints do sistema de playbooks.\n\n## üéØ Funcionalidades\n\n- **Topics**: Gerenciamento de t√≥picos (categorias gen√©ricas)\n- **Playbooks**: Cria√ß√£o e busca sem√¢ntica de playbooks\n- **Playbook Steps**: Passos organizados de mensagens\n- **Message Descriptions**: Gera√ß√£o AI de descri√ß√µes com Gemini Vision\n\n## üöÄ Como Usar\n\n1. Importe este arquivo no Postman (File > Import)\n2. Use o environment existente (WPP_Bot_API.postman_environment.json)\n3. Autentique com Auth > Login (do collection principal)\n4. Teste os novos endpoints\n\n## üìä Fluxo T√≠pico\n\n1. Criar Topic (categoria)\n2. Criar Messages (texto, imagem, v√≠deo, PDF)\n3. Gerar descri√ß√µes AI para mensagens visuais\n4. Criar Playbook vinculado ao Topic\n5. Adicionar Steps ao Playbook (mensagens ordenadas)\n6. Buscar semanticamente playbooks\n7. LLM usa playbooks automaticamente durante conversas",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"item": [
		{
			"name": "Topics",
			"item": [
				{
					"name": "Create Topic",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Botox\",\n  \"description\": \"Procedimento de aplica√ß√£o de toxina botul√≠nica para redu√ß√£o de rugas e linhas de express√£o\",\n  \"category\": \"procedimentos_esteticos\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/topics",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "topics"]
						},
						"description": "Criar novo t√≥pico (categoria gen√©rica para organizar playbooks).\n\nExemplos de t√≥picos:\n- Botox\n- Preenchimento Labial\n- Clareamento Dental\n- Agendamento de Consultas\n- D√∫vidas Frequentes"
					},
					"response": []
				},
				{
					"name": "Get Topic",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/topics/{{topic_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "topics", "{{topic_id}}"]
						},
						"description": "Buscar t√≥pico por ID."
					},
					"response": []
				},
				{
					"name": "List Topics",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/topics?active_only=false&skip=0&limit=100",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "topics"],
							"query": [
								{
									"key": "active_only",
									"value": "false",
									"description": "Filtrar apenas t√≥picos ativos"
								},
								{
									"key": "skip",
									"value": "0",
									"description": "Offset para pagina√ß√£o"
								},
								{
									"key": "limit",
									"value": "100",
									"description": "Limite de resultados"
								}
							]
						},
						"description": "Listar todos os t√≥picos com filtros opcionais."
					},
					"response": []
				},
				{
					"name": "Update Topic",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"description\": \"Procedimento minimamente invasivo de toxina botul√≠nica\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/topics/{{topic_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "topics", "{{topic_id}}"]
						},
						"description": "Atualizar campos do t√≥pico. Apenas campos fornecidos ser√£o alterados."
					},
					"response": []
				},
				{
					"name": "Delete Topic",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/topics/{{topic_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "topics", "{{topic_id}}"]
						},
						"description": "Deletar t√≥pico. CASCADE: Deleta todos os playbooks e steps associados."
					},
					"response": []
				}
			]
		},
		{
			"name": "Playbooks",
			"item": [
				{
					"name": "Create Playbook",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"topic_id\": \"{{topic_id}}\",\n  \"name\": \"Botox - Fluxo Completo de Atendimento\",\n  \"description\": \"Sequ√™ncia de mensagens para apresentar o procedimento de botox, incluindo explica√ß√£o, fotos antes/depois, valores e agendamento\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/playbooks",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbooks"]
						},
						"description": "Criar novo playbook.\n\n**Playbooks** s√£o sequ√™ncias organizadas de mensagens sobre um t√≥pico espec√≠fico.\n\nO playbook √© automaticamente indexado no ChromaDB para busca sem√¢ntica."
					},
					"response": []
				},
				{
					"name": "Search Playbooks (RAG)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/playbooks/search?query=botox procedimento valor antes depois&top_k=3&active_only=true",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbooks", "search"],
							"query": [
								{
									"key": "query",
									"value": "botox procedimento valor antes depois",
									"description": "Busca em linguagem natural"
								},
								{
									"key": "top_k",
									"value": "3",
									"description": "N√∫mero de resultados (m√°x 10)"
								},
								{
									"key": "active_only",
									"value": "true",
									"description": "Apenas playbooks ativos"
								}
							]
						},
						"description": "**Busca Sem√¢ntica com RAG** (Retrieval Augmented Generation).\n\nUsa ChromaDB + embeddings para encontrar playbooks relevantes.\n\nExemplos de queries:\n- \"botox pre√ßo procedimento\"\n- \"clareamento dental informa√ß√µes\"\n- \"preenchimento labial antes depois fotos\"\n- \"agendar consulta avalia√ß√£o\"\n\nRetorna playbooks ordenados por score de relev√¢ncia (0-1)."
					},
					"response": []
				},
				{
					"name": "Get Playbook",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/playbooks/{{playbook_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbooks", "{{playbook_id}}"]
						},
						"description": "Buscar playbook por ID."
					},
					"response": []
				},
				{
					"name": "List Playbooks by Topic",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/playbooks/topic/{{topic_id}}?active_only=false",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbooks", "topic", "{{topic_id}}"],
							"query": [
								{
									"key": "active_only",
									"value": "false",
									"description": "Filtrar apenas ativos"
								}
							]
						},
						"description": "Listar todos os playbooks de um t√≥pico espec√≠fico."
					},
					"response": []
				},
				{
					"name": "Update Playbook",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Botox - Fluxo Completo v2\",\n  \"description\": \"Fluxo atualizado com novos pre√ßos e fotos\",\n  \"active\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/playbooks/{{playbook_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbooks", "{{playbook_id}}"]
						},
						"description": "Atualizar playbook.\n\n**IMPORTANTE**: Atualiza√ß√£o reindexa automaticamente no ChromaDB."
					},
					"response": []
				},
				{
					"name": "Delete Playbook",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/playbooks/{{playbook_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbooks", "{{playbook_id}}"]
						},
						"description": "Deletar playbook.\n\nCADERNO:\n- Deleta steps associados\n- Remove embedding do ChromaDB"
					},
					"response": []
				}
			]
		},
		{
			"name": "Playbook Steps",
			"item": [
				{
					"name": "Add Step",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"playbook_id\": \"{{playbook_id}}\",\n  \"message_id\": \"{{message_id}}\",\n  \"step_order\": null,\n  \"context_hint\": \"Primeiro, enviar explica√ß√£o sobre o que √© botox e como funciona\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/playbook-steps",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbook-steps"]
						},
						"description": "Adicionar step ao playbook.\n\n**step_order**: Se null, √© adicionado no final automaticamente.\n**context_hint**: Dica para o LLM sobre quando usar este step."
					},
					"response": []
				},
				{
					"name": "List Playbook Steps",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/playbook-steps/playbook/{{playbook_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbook-steps", "playbook", "{{playbook_id}}"]
						},
						"description": "Listar todos os steps de um playbook, ordenados por step_order."
					},
					"response": []
				},
				{
					"name": "List Steps with Details (for LLM)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/playbook-steps/playbook/{{playbook_id}}/details",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbook-steps", "playbook", "{{playbook_id}}", "details"]
						},
						"description": "Listar steps com TODOS os detalhes das mensagens.\n\n**Uso**: Endpoint otimizado para o LLM consumir.\n\nRetorna:\n- Step order e context_hint\n- Message type, title, description, tags\n- Message content (text, media URL, caption, etc.)\n\nO LLM usa isso para decidir qual mensagem enviar."
					},
					"response": []
				},
				{
					"name": "Reorder Steps",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"step_id_order\": [\n    [\"step_id_1\", 1],\n    [\"step_id_2\", 2],\n    [\"step_id_3\", 3],\n    [\"step_id_4\", 4]\n  ]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/playbook-steps/reorder",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbook-steps", "reorder"]
						},
						"description": "Reordenar m√∫ltiplos steps de uma vez.\n\nUse para reorganizar a sequ√™ncia de mensagens no playbook."
					},
					"response": []
				},
				{
					"name": "Update Step",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"step_order\": 5,\n  \"context_hint\": \"Enviar apenas se cliente perguntar especificamente sobre valores\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/playbook-steps/{{step_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbook-steps", "{{step_id}}"]
						},
						"description": "Atualizar step order ou context hint."
					},
					"response": []
				},
				{
					"name": "Delete Step",
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/playbook-steps/{{step_id}}",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "playbook-steps", "{{step_id}}"]
						},
						"description": "Deletar step.\n\nAutomaticamente reindexa o playbook no ChromaDB."
					},
					"response": []
				}
			]
		},
		{
			"name": "Message Descriptions (AI)",
			"item": [
				{
					"name": "Generate AI Description",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/v1/messages/{{message_id}}/generate-description?use_gemini_vision=true",
							"host": ["{{base_url}}"],
							"path": ["api", "v1", "messages", "{{message_id}}", "generate-description"],
							"query": [
								{
									"key": "use_gemini_vision",
									"value": "true",
									"description": "Usar Gemini Vision para imagens/v√≠deos"
								}
							]
						},
						"description": "**Gerar descri√ß√£o AI com Gemini Vision**.\n\nPara mensagens de:\n- **Imagem**: Analisa conte√∫do visual\n- **V√≠deo**: Analisa thumbnail/preview\n- **Texto**: Analisa conte√∫do textual\n- **Documento**: Analisa nome e tipo\n\nRetorna:\n- `generated_title`: T√≠tulo descritivo (m√°x 50 chars)\n- `generated_description`: Descri√ß√£o detalhada (100-200 palavras)\n- `suggested_tags`: Tags relevantes (comma-separated)\n\n**Uso t√≠pico**:\n1. Admin faz upload de imagem\n2. Clica \"Gerar Descri√ß√£o com AI\"\n3. Gemini Vision analisa\n4. Admin revisa e edita se necess√°rio\n5. Salva mensagem com descri√ß√£o\n\nIsso ajuda o LLM a entender o conte√∫do das mensagens nos playbooks."
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "topic_id",
			"value": "paste-topic-uuid-here",
			"type": "string"
		},
		{
			"key": "playbook_id",
			"value": "paste-playbook-uuid-here",
			"type": "string"
		},
		{
			"key": "message_id",
			"value": "paste-message-uuid-here",
			"type": "string"
		},
		{
			"key": "step_id",
			"value": "paste-step-uuid-here",
			"type": "string"
		}
	]
}
